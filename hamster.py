import re

def hamster_converter(text):
    """í…ìŠ¤íŠ¸ë¥¼ í–„ì²´ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜"""
    if not text or not isinstance(text, str):
        return text
    
    result = text
    
    # 0. ì‘ì€ë”°ì˜´í‘œ ì•ˆì˜ ë‚´ìš© ë³´í˜¸
    quoted_parts = {}
    quote_pattern = r"'([^']*?)'"
    
    def replace_quoted(match):
        placeholder = f"TEMP_QUOTE_{len(quoted_parts)}"
        quoted_parts[placeholder] = match.group(0)
        return placeholder
    
    result = re.sub(quote_pattern, replace_quoted, result)
    
    # 1. "ì•„ì•„" ë³´í˜¸ (ì•„ì´ìŠ¤ì•„ë©”ë¦¬ì¹´ë…¸, ì˜ì„±ì–´)
    result = re.sub(r'ì•„ì•„', 'TEMP_AA', result)
    
    # 2. "ì•ˆë…•" â†’ "í–„í•˜" ë³€í™˜
    result = re.sub(r'ì•ˆë…•(?![í•˜íˆ])', 'í–„í•˜', result)
    result = re.sub(r'ë°”ì´', 'í–„ë°”', result)
    result = re.sub(r'ë¹ ì´', 'í–„ë¹ ', result)    
    # 3. "í•˜ì´" â†’ "í–„í•˜" ë³€í™˜ (ìƒˆë¡œ ì¶”ê°€)
    result = re.sub(r'í•˜ì´', 'í–„í•˜', result)

    result = re.sub(r'ì‚¬ëŒë“¤', 'í–„ì°Œë“¤', result)

    result = re.sub(r'ì‚¬ëŒì´', 'í–„ìŠ¤í„°ê°€', result)  # "ì‚¬ëŒ" â†’ "í–„ìŠ¤í„°"
    result = re.sub(r'ì‚¬ëŒì„', 'í–„ìŠ¤í„°ë¥¼', result)  # "ì‚¬ëŒì€" â†’ "í–„ìŠ¤í„°ëŠ”"
    result = re.sub(r'ì‚¬ëŒì´ì•¼', 'í–„ìŠ¤í„°ì–Œ', result)  # "ì‚¬ëŒì´ì•¼" â†’ "í–„ìŠ¤í„°ì–Œ"
    result = re.sub(r'ë‚˜ëŠ”\s*(\S+?)ì•¼', 'ë‚˜ëŠ” í–„ìŠ¤í„°ì–Œ', result)  # "ë‚˜ëŠ” [í•œê¸€]ì•¼" â†’ "ë‚˜ëŠ” í–„ìŠ¤í„°ì–Œ"
    result = re.sub(r'í–„ìŠ¤í„°', r'í–„ìŠ¤í„°ğŸ¹', result)  # "í–„ìŠ¤í„°" â†’ "í–„ìŠ¤í„°ğŸ¹"
    result = re.sub(r'([ê°€-í£])ì•¼(?=\s|$|[!?.,])', r'\1ì–Œ', result) # "ì•¼" â†’ "ì–Œ"

    result = re.sub(r'ì¡¸ë¦¬ë‹¤', 'ì¡¸ë ¤ì®¸ìš°ìš°..', result)
    result = re.sub(r'ì ì˜¨ë‹¤', 'ì ì™€ì®¸ìš°ìš°..', result)
    result = re.sub(r'(\s|^)í•´(\s|$)', r'\1í•´ì®¸\2', result)
    # ë°°ê³ í”” í‘œí˜„
 
    result = re.sub(r'ë°°ê³ íŒŒìš”?', 'ë°°ê³ íŒŒì®¸ìš°ìš°...', result)
    result = re.sub(r'ë°°ê³ í”„ë‹¤\b', 'ë°°ê³ íŒŒì®¸ìš°ìš°...', result)
    

    # ìŠ¬í”” í‘œí˜„  
    result = re.sub(r'ìŠ¬í¼', 'ìŠ¬í¼ì®¸ìš°ìš°...', result)
    result = re.sub(r'ìŠ¬í”„ë‹¤\b', 'ìŠ¬í¼ì®¸ìš°ìš°...', result)

    # ì‹¬ì‹¬í•¨ í‘œí˜„
    result = re.sub(r'ì‹¬ì‹¬í•´', 'ì‹¬ì‹¬í•´ì®¸ìš°ìš°...', result)
    result = re.sub(r'ì‹¬ì‹¬í•˜ë‹¤\b', 'ì‹¬ì‹¬í•˜ë‹¤ì®¸ìš°ìš°...', result)

    result = re.sub(r'ëƒ(ë©|ê°œ|ì˜¹|ì™ˆ)', 'ëƒì®¸', result)
    result = re.sub(r'ë‹¤(ì˜¹|ë©|ê°œ|ì™ˆ)', 'ë‹¤ì®¸', result)
    result = re.sub(r'ë‹¤\b', 'ë‹¤ì®¸', result)
    result = re.sub(r'ìš”\b', 'ìš”ì®¸', result)

    # 5. ëŒ€ë‹µ ë³€í™˜: "ì‘" â†’ "ì›…", "ë„¤" â†’ "ë„¹", "ì˜ˆ" â†’ "ë…±" (ì œí•œì )
    result = re.sub(r'^ì‘(?=[!?\s.,]|$)', 'ì›…', result)
    result = re.sub(r'(\s)ì‘(?=[!?\s.,]|$)', r'\1ì›…', result)
    # "ë„¤"ëŠ” ëª…í™•í•œ ëŒ€ë‹µì¼ ë•Œë§Œ ë³€í™˜ (ë¬¸ì¥ë¶€í˜¸ì™€ í•¨ê»˜)
    result = re.sub(r'^ë„¤([!?.,])', r'ë„¹\1', result)  # ì›ë³¸ ë¬¸ì¥ë¶€í˜¸ ìœ ì§€
    result = re.sub(r'^ë„¤(?=\s*$)', 'ë„¹', result)  # ë‹¨ë…ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
    result = re.sub(r'(\s)ë„¤([!?.,])', r'\1ë„¹\2', result)  # ì›ë³¸ ë¬¸ì¥ë¶€í˜¸ ìœ ì§€
    result = re.sub(r'(\s)ë„¤(?=\s*$)', r'\1ë„¹', result)  # ì¤‘ê°„ì— ë‹¨ë…ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
    # "ì˜ˆ"ëŠ” ëª…í™•í•œ ëŒ€ë‹µì¼ ë•Œë§Œ ë³€í™˜ (ë¬¸ì¥ë¶€í˜¸ì™€ í•¨ê»˜)
    result = re.sub(r'^ì˜ˆ([!?.,])', r'ë…±\1', result)  # ì›ë³¸ ë¬¸ì¥ë¶€í˜¸ ìœ ì§€
    result = re.sub(r'^ì˜ˆ(?=\s*$)', 'ë…±', result)  # ë‹¨ë…ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
    result = re.sub(r'(\s)ì˜ˆ([!?.,])', r'\1ë…±\2', result)  # ì›ë³¸ ë¬¸ì¥ë¶€í˜¸ ìœ ì§€
    result = re.sub(r'(\s)ì˜ˆ(?=\s*$)', r'\1ë…±', result)  # ì¤‘ê°„ì— ë‹¨ë…ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
    
    # 6. ê°íƒ„ì‚¬ ë³€í™˜: ë¬¸ì¥ ë§¨ ì•ì˜ ê°íƒ„ì‚¬ ë³€í™˜ (ë¬¸ì¥ ë ì²˜ë¦¬ ì „ì— ì‹¤í–‰)
    result = re.sub(r'^ì™€(?=\s|$|[.!?,:;~])', 'ê¾¸ì•™', result)
    result = re.sub(r'^ì˜¤(?=\s|$|[.!?,:;~])', 'ë„ì˜¤', result)
    result = re.sub(r'^ì•„(?=\s|$|[.!?,:;~])', 'ë€¨ì•„', result)
    
    # 7. ê°íƒ„ì‚¬ ë³€í™˜ (ì•—, ì•™, ìœ¼ì•…, ì•„ì•…) - ìœ„ì¹˜ì— ê´€ê³„ì—†ì´ ëª¨ë‘ ë³€í™˜
    result = re.sub(r'(?<![ê°€-í£])ì•™(?![ê°€-í£])', 'ì°', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ê²½ìš°
    result = re.sub(r'(?<![ê°€-í£])ì•—(?![ê°€-í£])', 'ì°', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ê²½ìš°
    result = re.sub(r'(?<![ê°€-í£])ìœ¼ì•…(?![ê°€-í£])', 'ë€¨ì•™', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ê²½ìš°
    result = re.sub(r'(?<![ê°€-í£])ì•„ì•…(?![ê°€-í£])', 'ë„ì•™', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ê²½ìš°
    
    # 8. ììŒ ì¡°í•© ë³€í™˜ (ê¸´ íŒ¨í„´ë¶€í„° ë¨¼ì € ì²˜ë¦¬)
    result = re.sub(r'(ã…ã…‡ã…Œ|í™”ì´íŒ…|íŒŒì´íŒ…)', 'í–„ì´íŒ…', result)  # ã…ã…‡ë³´ë‹¤ ë¨¼ì € ì²˜ë¦¬
    result = re.sub(r'ã…ã…‡', 'ì°í•˜', result)
    result = re.sub(r'ã…‡ã…', 'ì–´ë¨¸ì°', result)
    result = re.sub(r'ã…ã…‡', 'ëª¨ì•¼ì°', result)
    result = re.sub(r'ã„±ã…Š', 'ê´œì°®ì°', result)  # 
    # ã„±ã…‡ã…‡ë¥¼ ì„ì‹œë¡œ ë³´í˜¸
    result = re.sub(r'ã„±ã…‡ã…‡', 'TEMP_GYY', result)
    # ã…‡ã…‡ ë³€í™˜
    result = re.sub(r'ã…‡ã…‡', 'ì›…ì°', result)
    # ã„±ã…‡ã…‡ ë³µì›
    result = re.sub(r'TEMP_GYY', 'ã„±ã…‡ã…‡', result)
    
    result = re.sub(r'ã…‡ã„¸', 'ì–´ë– í–„', result)
    result = re.sub(r'(?<![ê°€-í£])ì•„í•˜(?![ê°€-í£])', 'ì•„í•˜ì®¸', result)  # ì•ë’¤ì— í•œê¸€ì´ ì—†ëŠ” ë…ë¦½ëœ "ì•„í•˜"ë§Œ
    
    # 9. íŠ¹ë³„ ë‹¨ì–´/ì–´ì ˆ ì²˜ë¦¬
    # "ê°œì›ƒ" â†’ "í–„ì›ƒ" (í–„ì›ƒê²¨, í–„ì›ƒê¸°ë‹¤, í–„ì›ƒê¹€ ë“±)
    result = re.sub(r'ê°œì›ƒ', 'í–„ì›ƒ', result)
    
    # ê³µë°± ë’¤ ê°•ì¡° í‘œí˜„: "í–„ì´ì˜", "í–„ê·€ì—½", "í–„ê·€ì—¬" â†’ "í–„ì´ì˜", "í–„ê·€ì—½", "í–„ê·€ì—¬" (ê°•ì¡° ìš©ë²•ë§Œ)
    result = re.sub(r'(\s)ê°œ(ì´ì˜|ê·€ì—½|ê·€ì—¬)', r'\1í–„\2', result)  # ê³µë°± ë’¤ì—ë§Œ
    
    # "ì¡´" ê°•ì¡° í‘œí˜„ ë³€í™˜ (ê³µë°± ë’¤ì—ë§Œ)
    result = re.sub(r'(\s)ì¡´(ì¼|ë§›|ë§›íƒ±|ì˜ˆ|ê·€|ì¢‹)', r'\1í–„\2', result)  # ê³µë°± ë’¤ì—ë§Œ
    
    # ë’¤ì— í•œê¸€ì´ ì˜¤ì§€ ì•ŠëŠ” ê²½ìš°ì—ë§Œ ë© ë¶™ì´ê¸°
    result = re.sub(r'(ë§ì•„|ë§ˆì|ë§ˆì¢Œ|ë§ˆìŸˆ)(?![ê°€-í£])', r'\1ì®¸', result)
    

    #  "í–ˆì§€", "ì—ˆì§€", "ì•˜ì§€" ë³€í™˜
    result = re.sub(r'í–ˆì§€', 'í•´ì°Œ', result)
    result = re.sub(r'ì—ˆì§€', 'ì–´ì°Œ', result) 
    result = re.sub(r'ì•˜ì§€', 'ì•„ì°Œ', result)
    result = re.sub(r'ìˆì§€', 'ì´ì°Œ', result)
    result = re.sub(r'ì—†ì§€', 'ì—…ì°Œ', result)

    # 10. ë¬¸ì¥ ëì— "ì°" ì¶”ê°€ (í•œêµ­ì–´ê°€ í¬í•¨ëœ ê²½ìš°ë§Œ)
    if re.search(r'[ê°€-í£]', result):
        # ë¬¸ì¥ ë ì²˜ë¦¬ - ë¬¸ì¥ë¶€í˜¸ë¡œ ëë‚˜ëŠ” ê²½ìš°
        result = re.sub(r'([ê°€-í£])(?<![ì°ì®¸ì°Œ])(\s*[.!?~\\;]+)(?![ê°€-í£])', r'\1ì°\2', result)

        
        # ì´ëª¨í‹°ì½˜ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°
        result = re.sub(r'([ê°€-í£])(?<![ì°ì®¸ì°Œ])(\s*\^\^\s*$)', r'\1ì°\2', result)  # ^^ ì´ëª¨í‹°ì½˜
        result = re.sub(r'([ê°€-í£])(?<![ì°ì®¸ì°Œ])(\s*:\)\s*$)', r'\1ì°\2', result)  # :) ì´ëª¨í‹°ì½˜
        result = re.sub(r'([ê°€-í£])(?<![ì°ì®¸ì°Œ])(\s*[\U0001F600-\U0001F64F\U0001F300-\U0001F5FF\U0001F680-\U0001F6FF\U0001F1E0-\U0001F1FF\u2600-\u26FF\u2700-\u27BF]+\s*$)', r'\1ì°\2', result)  # ìœ ë‹ˆì½”ë“œ ì´ëª¨í‹°ì½˜
        
        # ììŒ/ëª¨ìŒ(ã…‹ã…‹, ã…ã…, ã…‡ã…‹ ë“±) ì•ì˜ í•œê¸€ì— "ì°" ì¶”ê°€
        result = re.sub(r'([ê°€-í£])(?<!ì°)(\s*[ã„±-ã…ã…-ã…£ã…‹ã…ã…‡ã…‹]+)', r'\1ì°\2', result)  # ììŒ/ëª¨ìŒ ì•
        
        # ì¤„ë°”ê¿ˆ ì²˜ë¦¬
        result = re.sub(r'([ê°€-í£])(?<!ì°)(\s*\r?\n)', r'\1ì°\2', result)  # ì¤„ë°”ê¿ˆìœ¼ë¡œ ë
        
        # ë¬¸ì¥ë¶€í˜¸ ì—†ì´ ëë‚˜ëŠ” ê²½ìš°
        result = re.sub(r'([ê°€-í£])(?<!ì°)(\s*$)', r'\1ì°\2', result)  # ê·¸ëƒ¥ ëë‚˜ëŠ” ê²½ìš°
    
    
    # 12. ë¶ˆí•„ìš”í•œ "ì°" ì œê±° (íŠ¹ë³„ ë³€í™˜ í›„ ë¶™ì€ ì° ì •ë¦¬)
    # ë‹¨ì¼ íŒ¨í„´ ë’¤ì˜ ì° ì œê±°
    result = re.sub(r'(í–„í•˜|ë¯¸ìŠ¤ì½”ë¦¬ëƒ¥|#ë¯¸ìŠ¤ì½”ë¦¬ëƒ¥|ì°ì°|ì•„í•˜ì®¸|ì™•ì™•|ì–´ì°Œ|ì´ì°Œ|í™”ì´ì°¡|ê¾¸ì•™|ë„ì˜¤|ë€¨ì•…|í–„ì¼|í–„ë§›|í–„ë§›íƒ±|í–„ì˜ˆ|í–„ê·€|í–„ì¢‹|ì®¸|ì–´ë– í–„|ë€¨ì•™|ì®¸ìš°ìš°|í–„ë°”|í–„ë¹ |í–„ì°Œë“¤)ì°', r'\1', result)
    

    result = re.sub(r'TEMP_AA', 'ì•„ì•„', result)

    return result